<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RAG Demo</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 2rem; max-width: 900px; }
      textarea, input { width: 100%; padding: 0.5rem; margin: 0.25rem 0 1rem; }
      button { padding: 0.5rem 1rem; margin-right: 0.5rem; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
      .card { border: 1px solid #ddd; border-radius: 8px; padding: 1rem; }
      pre { background: #f7f7f7; padding: 0.75rem; overflow: auto; }
    </style>
  </head>
  <body>
    <h1>RAG Demo</h1>
    <p>Use this page to ingest texts and query the vector index.</p>

    <div class="row">
      <div class="card">
        <h2>Ingest</h2>
        <label for="texts">Texts (one per line)</label>
        <textarea id="texts" rows="8">Hello world
FastAPI is great
We build RAG demos</textarea>
        <button id="ingestBtn">Ingest</button>
        <pre id="ingestOut"></pre>
      </div>

      <div class="card">
        <h2>Query</h2>
        <label for="question">Question</label>
        <input id="question" value="What is FastAPI?" />
        <label for="topk">Top K</label>
        <input id="topk" type="number" value="3" min="1" />
        <label>
          <input id="generate" type="checkbox" /> Generate answer
        </label>
        <button id="queryBtn">Query</button>
        <label for="answer">Answer</label>
        <pre id="answer"></pre>
        <label for="queryOut">Raw JSON</label>
        <pre id="queryOut"></pre>
      </div>
    </div>

    <script>
      const ingestBtn = document.getElementById("ingestBtn");
      const queryBtn = document.getElementById("queryBtn");

      ingestBtn.addEventListener("click", async () => {
        const texts = document.getElementById("texts").value
          .split("\n")
          .map((t) => t.trim())
          .filter(Boolean);
        const res = await fetch("/ingest", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ texts }),
        });
        const data = await res.json();
        document.getElementById("ingestOut").textContent = JSON.stringify(data, null, 2);
      });

      queryBtn.addEventListener("click", async () => {
        const question = document.getElementById("question").value;
        const top_k = Number(document.getElementById("topk").value || 3);
        const generate = document.getElementById("generate").checked;
        const res = await fetch("/query", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question, top_k, generate }),
        });
        const data = await res.json();
        const fallback = data.results && data.results[0] ? data.results[0].text : "";
        const answer = data.answer || fallback || "(no answer)";
        document.getElementById("answer").textContent = answer;
        document.getElementById("queryOut").textContent = JSON.stringify(data, null, 2);
      });
    </script>
  </body>
</html>
